<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CartPole for C++: CartPole-for-CPP</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CartPole for C++
   &#160;<span id="projectnumber">0.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md_README.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">CartPole-for-CPP </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>これはOpenAI Gymの<a href="https://github.com/openai/gym/wiki/CartPole-v0">'CartPole-v0'</a>をC/C++とgnuplotで書き直したものです．PythonではなくC/C++で機械学習のテストがしたいという方向けに開発しました．パスの設定などは一切必要なく，cartpole_cpp.hppをインクルードするだけで実行できるため，linuxなどに詳しくない方でもすぐに使えます．</p>
<h1><a class="anchor" id="autotoc_md1"></a>
OpenAI GymのCartPoleとは</h1>
<p><a href="https://github.com/openai/gym">OpenAI Gym</a>とは人工知能を研究する非営利企業<a href="https://openai.com/">OpenAI</a>が提供する強化学習のシミュレーション用プラットフォームです．その中でCartPoleは台車の上に載った棒をどれだけ長い時間立てていられるかというシミュレーションです．ユーザーは各タイムステップで，台車を左に押すか右の押すかのどちらかの行動をとり，棒が倒れないように台車を動かします．</p>
<h1><a class="anchor" id="autotoc_md2"></a>
DEMO</h1>
<p>Q学習で強化学習した例</p>
<p><img src="https://user-images.githubusercontent.com/56115620/76943403-a1b56880-6942-11ea-90d1-4135a84e7d9a.gif" alt="learned" class="inline"/></p>
<h1><a class="anchor" id="autotoc_md3"></a>
Requirement</h1>
<ul>
<li>C++17</li>
<li>g++ 7.5.0</li>
<li>gnuplot 5.2 patchlevel 2</li>
<li>vlc</li>
</ul>
<h1><a class="anchor" id="autotoc_md4"></a>
Installation</h1>
<p>環境はUbuntu　18.04ですが，linuxであればなんでも動くと思います．</p>
<div class="fragment"><div class="line">sudo apt install g++</div>
<div class="line">sudo apt install gnuplot</div>
<div class="line">sudo apt install vlc</div>
<div class="line">git clone https://github.com/H1dek1/CartPole-for-CPP.git</div>
</div><!-- fragment --><p>CartPole-for-CPPにはライブラリの他に使い方の例としてサンプルプログラムが含まれています．サンプルプログラムを実行するには以下を実行します．</p>
<div class="fragment"><div class="line">cd cartpole_cpp</div>
<div class="line">./sample.sh</div>
<div class="line">vlc result.mp4</div>
</div><!-- fragment --><p>これで動画が再生されればインストール完了です．</p>
<h1><a class="anchor" id="autotoc_md5"></a>
Usage</h1>
<p>このプログラムはcartpole_cpp.hppをインクルードするだけで利用できます．</p>
<div class="fragment"><div class="line">#include &quot;cartpole_cpp.hpp&quot;</div>
</div><!-- fragment --><p>以下のコマンドで環境のインスタンスを作成し，環境を初期化します．</p>
<div class="fragment"><div class="line">CartPole env;</div>
<div class="line">std::vector&lt;double&gt; observation = env.reset();</div>
</div><!-- fragment --><p>cartの位置と速度，poleの角度と角速度は本家と同じく-0.05~+0.05の範囲の中で乱数によって初期化されます．reset()関数は返り値としてcartの位置，cartの速度，poleの位置，poleの速度を，double型の配列（要素数4）で返します．</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Num </th><th class="markdownTableHeadLeft">observation </th><th class="markdownTableHeadLeft">Min </th><th class="markdownTableHeadLeft">Max  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">0 </td><td class="markdownTableBodyLeft">Cart Position </td><td class="markdownTableBodyLeft">-2.4 </td><td class="markdownTableBodyLeft">2.4  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">1 </td><td class="markdownTableBodyLeft">Cart Velocity </td><td class="markdownTableBodyLeft">-inf </td><td class="markdownTableBodyLeft">inf  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">2 </td><td class="markdownTableBodyLeft">Pole Angle </td><td class="markdownTableBodyLeft">-41.8 degree </td><td class="markdownTableBodyLeft">41.8 degree  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">3 </td><td class="markdownTableBodyLeft">Pole Angular Velocity </td><td class="markdownTableBodyLeft">-inf </td><td class="markdownTableBodyLeft">inf  </td></tr>
</table>
<p>(引用：<a href="https://github.com/openai/gym/wiki/CartPole-v0">CartPole-v0</a>)</p>
<p>step関数は環境を1ステップ進める関数です．第一引数のflagはbool値で，falseにすると，外力を受けなくなります．第二引数のactionは本家と同じく，</p>
<div class="fragment"><div class="line">std::tie(observation, reward, done) = env.step(flag, action);</div>
</div><!-- fragment --><p>第一引数のflagはbool型で，falseにすると，外力を受けなくなります．第二引数のactionは本家と同じく，次のように設定しています．</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Num </th><th class="markdownTableHeadLeft">Action  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">0 </td><td class="markdownTableBodyLeft">Push cart to the left  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">1 </td><td class="markdownTableBodyLeft">Push cart to the right  </td></tr>
</table>
<p>(引用：<a href="https://github.com/openai/gym/wiki/CartPole-v0">CartPole-v0</a>)</p>
<p>返り値についても基本的には本家を踏襲しています．返り値はdouble型配列observationとdouble型変数reward，bool型変数doneです．rewardは報酬で，cartの位置とpoleの角度が上の表の範囲にあるときには1を，範囲外にあるときは0を返します．doneは初期状態でfalseに設定され，cartの位置かpoleの角度が範囲外に出たとき，またはステップ数が200を超えるとtrueを返します．</p>
<div class="fragment"><div class="line">env.render(filename);</div>
</div><!-- fragment --><p>render()関数はそのステップのときの環境を外部ファイルに記録する関数です．動画にしたい試行では，毎ステップこの関数を実行することでlogファイルを作成し，動画にすることができます．引数のfilenameは出力するlogファイルを指定します．プログラムを実行するディレクトリからの相対パスをstring型で渡してください．</p>
<h1><a class="anchor" id="autotoc_md6"></a>
Environment</h1>
<p>本プログラムの環境は次のようなものです． <img src="https://user-images.githubusercontent.com/56115620/77053217-5918b080-6a11-11ea-846a-49924e6765c8.png" alt="cartpole" class="inline"/></p>
<h2><a class="anchor" id="autotoc_md7"></a>
Motion Equation &amp; Algorithm</h2>
<p>プログラムのアルゴリズムの元になる系のラグランジュの運動方程式を示します．cartの位置は<a href="https://www.codecogs.com/eqnedit.php?latex=\inline&space;\left(&space;X,&space;0&space;\right&space;)" target="_blank"><img src="https://latex.codecogs.com/gif.latex?\inline&space;\left(&space;X,&space;0&space;\right&space;)" alt="" title="\left( X, 0 \right )" class="inline"/></a>，poleの重心位置は<a href="https://www.codecogs.com/eqnedit.php?latex=\inline&space;\left(&space;X&plus;lsin\theta,&space;lcos\theta&space;\right&space;)" target="_blank"><img src="https://latex.codecogs.com/png.latex?\inline&space;\left(&space;X&plus;lsin\theta,&space;lcos\theta&space;\right&space;)" alt="" title="\left( X+lsin\theta, lcos\theta \right )" class="inline"/></a>であるから，ラグランジアンは，</p>
<p><a href="https://www.codecogs.com/eqnedit.php?latex=\inline&space;L=K-U=\frac{M}{2}{\dot{X}}^2&plus;\frac{m}{2}\left(\dot{x}^2&plus;\dot{y}^2&space;\right&space;)-mglcos\theta" target="_blank"><img src="https://latex.codecogs.com/gif.latex?\inline&space;L=K-U=\frac{M}{2}{\dot{X}}^2&plus;\frac{m}{2}\left(\dot{x}^2&plus;\dot{y}^2&space;\right&space;)-mglcos\theta" alt="" title="L=K-U=\frac{M}{2}{\dot{X}}^2+\frac{m}{2}\left(\dot{x}^2+\dot{y}^2 \right )-mglcos\theta" class="inline"/></a></p>
<p>これより<a href="https://www.codecogs.com/eqnedit.php?latex=\inline&space;X" target="_blank"><img src="https://latex.codecogs.com/png.latex?\inline&space;X" alt="" title="X" class="inline"/></a>に関する運動方程式は，</p>
<p><a href="https://www.codecogs.com/eqnedit.php?latex=\frac{d}{dt}\left(&space;\frac{\partial&space;L}{\partial&space;\dot{X}}&space;\right)-\frac{\partial&space;L}{\partial&space;X}=F\Leftrightarrow&space;\ddot{X}=\frac{F}{m&plus;M}-\frac{ml}{m&plus;M}\left(&space;\ddot{\theta}cos\theta-\dot{\theta}^2sin\theta&space;\right&space;)" target="_blank"><img src="https://latex.codecogs.com/png.latex?\frac{d}{dt}\left(&space;\frac{\partial&space;L}{\partial&space;\dot{X}}&space;\right)-\frac{\partial&space;L}{\partial&space;X}=F\Leftrightarrow&space;\ddot{X}=\frac{F}{m&plus;M}-\frac{ml}{m&plus;M}\left(&space;\ddot{\theta}cos\theta-\dot{\theta}^2sin\theta&space;\right&space;)" alt="" title="\frac{d}{dt}\left( \frac{\partial L}{\partial \dot{X}} \right)-\frac{\partial L}{\partial X}=F\Leftrightarrow \ddot{X}=\frac{F}{m+M}-\frac{ml}{m+M}\left( \ddot{\theta}cos\theta-\dot{\theta}^2sin\theta \right )" class="inline"/></a></p>
<p><a href="https://www.codecogs.com/eqnedit.php?latex=\inline&space;\theta" target="_blank"><img src="https://latex.codecogs.com/png.latex?\inline&space;\theta" alt="" title="\theta" class="inline"/></a>に関する運動方程式は，</p>
<p><a href="https://www.codecogs.com/eqnedit.php?latex=\frac{d}{dt}\left(&space;\frac{\partial&space;L}{\partial&space;\dot{\theta}}&space;\right)-\frac{\partial&space;L}{\partial&space;\theta}=0\Leftrightarrow&space;\ddot{\theta}=\frac{g}{l}sin\theta-\frac{\ddot{X}}{l}cos\theta" target="_blank"><img src="https://latex.codecogs.com/png.latex?\frac{d}{dt}\left(&space;\frac{\partial&space;L}{\partial&space;\dot{\theta}}&space;\right)-\frac{\partial&space;L}{\partial&space;\theta}=0\Leftrightarrow&space;\ddot{\theta}=\frac{g}{l}sin\theta-\frac{\ddot{X}}{l}cos\theta" alt="" title="\frac{d}{dt}\left( \frac{\partial L}{\partial \dot{\theta}} \right)-\frac{\partial L}{\partial \theta}=0\Leftrightarrow \ddot{\theta}=\frac{g}{l}sin\theta-\frac{\ddot{X}}{l}cos\theta" class="inline"/></a></p>
<p>これらより，</p>
<p><a href="https://www.codecogs.com/eqnedit.php?latex=\ddot{X}=\frac{F-mgsin\theta&space;cos\theta&space;&plus;&space;ml\dot{\theta}^2&space;sin\theta}{msin^2\theta&plus;M}" target="_blank"><img src="https://latex.codecogs.com/png.latex?\ddot{X}=\frac{F-mgsin\theta&space;cos\theta&space;&plus;&space;ml\dot{\theta}^2&space;sin\theta}{msin^2\theta&plus;M}" alt="" title="\ddot{X}=\frac{F-mgsin\theta cos\theta + ml\dot{\theta}^2 sin\theta}{msin^2\theta+M}" class="inline"/></a></p>
<p>本プログラムでは以上の式から入力を外力<a href="https://www.codecogs.com/eqnedit.php?latex=F" target="_blank"><img src="https://latex.codecogs.com/png.latex?F" alt="" title="F" class="inline"/></a>として，cartの位置，poleの角度を更新している．</p>
<p># Note</p>
<p># Author</p>
<ul>
<li>H1dek1</li>
</ul>
<p># License</p>
<ul>
<li>H1dek1 </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
